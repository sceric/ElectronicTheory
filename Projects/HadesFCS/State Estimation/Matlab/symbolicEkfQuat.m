syms f0 f1 f2 f3 real
f = [f0; f1; f2; f3; 0; 0; 0; 0; 0; 0];

syms A12 A13 A14 A15 A16 A17 A21 A23 A24 A25 A26 A27 A31 A32 A34 A35 A36 A37 A41 A42 A43 A45 A46 A47 real

A = [0,   A12, A13, A14, A15, A16, A17, 0, 0, 0; ...
     A21,  0,  A23, A24, A25, A26, A27, 0, 0, 0; ...
     A31, A32,   0, A34, A35, A36, A37, 0, 0, 0; ...
     A41, A42, A43,   0, A45, A46, A47, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0; ...
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

P = sym('P%d%d', [10 10]);

syms Q1 Q2 Q3 Q4 Q5 Q6 Q7 Q8 Q9 Q10 real
Q = diag([Q1, Q2, Q3, Q4, Q5, Q6, Q7, Q8, Q9, Q10]);

syms T

Pnew = P + T * (A * P + P * A' + Q);

syms C11 C12 C13 C14 C21 C22 C23 C24 C31 C32 C33 C34 C41 C42 C43 C44 V real
C = [C11, C12, C13, C14, 0, 0,  0, -1,  0,  0; ...
     C21, C22, C23, C24, 0, 0, -V,  0, -1,  0; ...
     C31, C32, C33, C34, 0, V,  0,  0,  0, -1; ...
     C41, C42, C43, C44, 0, 0,  0,  0,  0,  0];
 
syms R1 R2 R3 R4
R = diag([R1, R2, R3, R4]);

%K = P * C' / (C * P * C' + R);
T = sym('T%d%d', [4 4]);

K = P * C' * T^(-1);

Kprime = sym('K%d%d', [10 4]);

Pnew2 = (eye(10) - Kprime * C) * P;

    